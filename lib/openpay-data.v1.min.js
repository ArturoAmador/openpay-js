"use strict";(function(){var e=function(){};e._collectorIframe="logo.htm";e._collectorImg="logo.gif";e._collectorId=12345;e._sandboxCollectorId=6789;e._deviceDataId=undefined;function c(){return a.codec.base64.fromBits(a.random.randomWords(6,0))}function d(g,i){var h=document.createElement("input");h.type="hidden";h.value=i;h.name=g;return h}function b(h,g){setTimeout(function(){var j=document.createElement("iframe");j.width=1;j.height=1;j.frameBorder=0;j.scrolling="no";j.src=h;document.body.appendChild(j);var i=document.createElement("img");i.src=g;i.width=1;i.height=1;j.appendChild(i)},50)}function f(){if(e._deviceDataId===undefined){e._deviceDataId=c()}return e._deviceDataId}e.getDeviceDataId=f;e.setupForm=function(i,l){document.getElementById(i).appendChild(d(l,f()));var h="?m="+(OpenPay.sandboxMode?this._sandboxCollectorId:this._collectorId)+"&s="+f();var g=(OpenPay.sandboxMode?OpenPay.sandboxHostname:OpenPay.hostname);var j=g+this._collectorImg+h;var k=g+this._collectorIframe+h;b(k,j)};OpenPay.deviceData=e;var a={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(g){this.toString=function(){return"CORRUPT: "+this.message};this.message=g},invalid:function(g){this.toString=function(){return"INVALID: "+this.message};this.message=g},bug:function(g){this.toString=function(){return"BUG: "+this.message};this.message=g},notReady:function(g){this.toString=function(){return"NOT READY: "+this.message};this.message=g}}};if(typeof module!=="undefined"&&module.exports){module.exports=a}a.cipher.aes=function(p){if(!this._tables[0][0][0]){this._precompute()}var l,k,m,o,r,n=this._tables[0][4],q=this._tables[1],g=p.length,h=1;if(g!==4&&g!==6&&g!==8){throw new a.exception.invalid("invalid aes key size")}this._key=[o=p.slice(0),r=[]];for(l=g;l<4*g+28;l++){m=o[l-1];if(l%g===0||g===8&&l%g===4){m=n[m>>>24]<<24^n[m>>16&255]<<16^n[m>>8&255]<<8^n[m&255];if(l%g===0){m=m<<8^m>>>24^h<<24;h=h<<1^(h>>7)*283}}o[l]=o[l-g]^m}for(k=0;l;k++,l--){m=o[k&3?l:l-4];if(l<=4||k<4){r[k]=m}else{r[k]=q[0][n[m>>>24]]^q[1][n[m>>16&255]]^q[2][n[m>>8&255]]^q[3][n[m&255]]}}};a.cipher.aes.prototype={encrypt:function(g){return this._crypt(g,0)},decrypt:function(g){return this._crypt(g,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var o=this._tables[0],w=this._tables[1],n=o[4],t=w[4],m,q,l,p=[],j=[],h,v,r,u,k,g;for(m=0;m<256;m++){j[(p[m]=m<<1^(m>>7)*283)^m]=m}for(q=l=0;!n[q];q^=h||1,l=j[l]||1){u=l^l<<1^l<<2^l<<3^l<<4;u=u>>8^u&255^99;n[q]=u;t[u]=q;r=p[v=p[h=p[q]]];g=r*16843009^v*65537^h*257^q*16843008;k=p[u]*257^u*16843008;for(m=0;m<4;m++){o[m][q]=k=k<<24^k>>>8;w[m][u]=g=g<<24^g>>>8}}for(m=0;m<5;m++){o[m]=o[m].slice(0);w[m]=w[m].slice(0)}},_crypt:function(m,p){if(m.length!==4){throw new a.exception.invalid("invalid aes block size")}var A=this._key[p],x=m[0]^A[0],w=m[p?3:1]^A[1],v=m[2]^A[2],u=m[p?1:3]^A[3],y,g,o,z=A.length/4-2,r,q=4,s=[0,0,0,0],t=this._tables[p],l=t[0],k=t[1],j=t[2],h=t[3],n=t[4];for(r=0;r<z;r++){y=l[x>>>24]^k[w>>16&255]^j[v>>8&255]^h[u&255]^A[q];g=l[w>>>24]^k[v>>16&255]^j[u>>8&255]^h[x&255]^A[q+1];o=l[v>>>24]^k[u>>16&255]^j[x>>8&255]^h[w&255]^A[q+2];u=l[u>>>24]^k[x>>16&255]^j[w>>8&255]^h[v&255]^A[q+3];q+=4;x=y;w=g;v=o}for(r=0;r<4;r++){s[p?3&-r:r]=n[x>>>24]<<24^n[w>>16&255]<<16^n[v>>8&255]<<8^n[u&255]^A[q++];y=x;x=w;w=v;v=u;u=y}return s}};a.bitArray={bitSlice:function(g,h,i){g=a.bitArray._shiftRight(g.slice(h/32),32-(h&31)).slice(1);return i===undefined?g:a.bitArray.clamp(g,i-h)},extract:function(h,i,k){var g,j=Math.floor(-i-k&31);if((i+k-1^i)&-32){g=h[i/32|0]<<32-j^h[i/32+1|0]>>>j}else{g=h[i/32|0]>>>j}return g&(1<<k)-1},concat:function(j,g){if(j.length===0||g.length===0){return j.concat(g)}var k,l,m=j[j.length-1],h=a.bitArray.getPartial(m);if(h===32){return j.concat(g)}else{return a.bitArray._shiftRight(g,h,m|0,j.slice(0,j.length-1))}},bitLength:function(i){var h=i.length,g;if(h===0){return 0}g=i[h-1];return(h-1)*32+a.bitArray.getPartial(g)},clamp:function(i,g){if(i.length*32<g){return i}i=i.slice(0,Math.ceil(g/32));var h=i.length;g=g&31;if(h>0&&g){i[h-1]=a.bitArray.partial(g,i[h-1]&2147483648>>g-1,1)}return i},partial:function(h,g,i){if(h===32){return g}return(i?g|0:g<<32-h)+h*1099511627776},getPartial:function(g){return Math.round(g/1099511627776)||32},equal:function(j,h){if(a.bitArray.bitLength(j)!==a.bitArray.bitLength(h)){return false}var g=0,k;for(k=0;k<j.length;k++){g|=j[k]^h[k]}return g===0},_shiftRight:function(j,h,n,l){var m,g=0,k;if(l===undefined){l=[]}for(;h>=32;h-=32){l.push(n);n=0}if(h===0){return l.concat(j)}for(m=0;m<j.length;m++){l.push(n|j[m]>>>h);n=j[m]<<32-h}g=j.length?j[j.length-1]:0;k=a.bitArray.getPartial(g);l.push(a.bitArray.partial(h+k&31,h+k>32?n:l.pop(),1));return l},_xor4:function(g,h){return[g[0]^h[0],g[1]^h[1],g[2]^h[2],g[3]^h[3]]}};a.codec.utf8String={fromBits:function(g){var h="",l=a.bitArray.bitLength(g),k,j;for(k=0;k<l/8;k++){if((k&3)===0){j=g[k/4]}h+=String.fromCharCode(j>>>24);j<<=8}return decodeURIComponent(escape(h))},toBits:function(k){k=unescape(encodeURIComponent(k));var g=[],j,h=0;for(j=0;j<k.length;j++){h=h<<8|k.charCodeAt(j);if((j&3)===3){g.push(h);h=0}}if(j&3){g.push(a.bitArray.partial(8*(j&3),h))}return g}};a.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(m,p,h){var j="",k,o=0,n=a.codec.base64._chars,l=0,g=a.bitArray.bitLength(m);if(h){n=n.substr(0,62)+"-_"}for(k=0;j.length*6<g;){j+=n.charAt((l^m[k]>>>o)>>>26);if(o<6){l=m[k]<<6-o;o+=26;k++}else{l<<=6;o-=6}}while(j.length&3&&!p){j+="="}return j},toBits:function(n,l){n=n.replace(/\s|=/g,"");var j=[],k,m=0,o=a.codec.base64._chars,h=0,g;if(l){o=o.substr(0,62)+"-_"}for(k=0;k<n.length;k++){g=o.indexOf(n.charAt(k));if(g<0){throw new a.exception.invalid("this isn't base64!")}if(m>26){m-=26;j.push(h^g>>>m);h=g<<32-m}else{m+=6;h^=g<<32-m}}if(m&56){j.push(a.bitArray.partial(m&56,h,1))}return j}};a.codec.base64url={fromBits:function(g){return a.codec.base64.fromBits(g,1,1)},toBits:function(g){return a.codec.base64.toBits(g,1)}};a.hash.sha256=function(g){if(!this._key[0]){this._precompute()}if(g){this._h=g._h.slice(0);this._buffer=g._buffer.slice(0);this._length=g._length}else{this.reset()}};a.hash.sha256.hash=function(g){return(new a.hash.sha256).update(g).finalize()};a.hash.sha256.prototype={blockSize:512,reset:function(){this._h=this._init.slice(0);this._buffer=[];this._length=0;return this},update:function(l){if(typeof l==="string"){l=a.codec.utf8String.toBits(l)}var k,g=this._buffer=a.bitArray.concat(this._buffer,l),j=this._length,h=this._length=j+a.bitArray.bitLength(l);for(k=512+j&-512;k<=h;k+=512){this._block(g.splice(0,16))}return this},finalize:function(){var j,g=this._buffer,k=this._h;g=a.bitArray.concat(g,[a.bitArray.partial(1,1)]);for(j=g.length+2;j&15;j++){g.push(0)}g.push(Math.floor(this._length/4294967296));g.push(this._length|0);while(g.length){this._block(g.splice(0,16))}this.reset();return k},_init:[],_key:[],_precompute:function(){var k=0,j=2,h;function g(i){return(i-Math.floor(i))*4294967296|0}outer:for(;k<64;j++){for(h=2;h*h<=j;h++){if(j%h===0){continue outer}}if(k<8){this._init[k]=g(Math.pow(j,1/2))}this._key[k]=g(Math.pow(j,1/3));k++}},_block:function(u){var l,m,y,x,z=u.slice(0),o=this._h,g=this._key,v=o[0],t=o[1],s=o[2],r=o[3],q=o[4],p=o[5],n=o[6],j=o[7];for(l=0;l<64;l++){if(l<16){m=z[l]}else{y=z[l+1&15];x=z[l+14&15];m=z[l&15]=(y>>>7^y>>>18^y>>>3^y<<25^y<<14)+(x>>>17^x>>>19^x>>>10^x<<15^x<<13)+z[l&15]+z[l+9&15]|0}m=m+j+(q>>>6^q>>>11^q>>>25^q<<26^q<<21^q<<7)+(n^q&(p^n))+g[l];j=n;n=p;p=q;q=r+m|0;r=s;s=t;t=v;v=m+(t&s^r&(t^s))+(t>>>2^t>>>13^t>>>22^t<<30^t<<19^t<<10)|0}o[0]=o[0]+v|0;o[1]=o[1]+t|0;o[2]=o[2]+s|0;o[3]=o[3]+r|0;o[4]=o[4]+q|0;o[5]=o[5]+p|0;o[6]=o[6]+n|0;o[7]=o[7]+j|0}};a.prng=function(g){this._pools=[new a.hash.sha256];this._poolEntropy=[0];this._reseedCount=0;this._robins={};this._eventId=0;this._collectorIds={};this._collectorIdNext=0;this._strength=0;this._poolStrength=0;this._nextReseed=0;this._key=[0,0,0,0,0,0,0,0];this._counter=[0,0,0,0];this._cipher=undefined;this._defaultParanoia=g;this._collectorsStarted=false;this._callbacks={progress:{},seeded:{}};this._callbackI=0;this._NOT_READY=0;this._READY=1;this._REQUIRES_RESEED=2;this._MAX_WORDS_PER_BURST=65536;this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024];this._MILLISECONDS_PER_RESEED=30000;this._BITS_PER_RESEED=80};a.prng.prototype={randomWords:function(h,n){var j=[],l,k=this.isReady(n),m;if(k===this._NOT_READY){throw new a.exception.notReady("generator isn't seeded")}else{if(k&this._REQUIRES_RESEED){this._reseedFromPools(!(k&this._READY))}}for(l=0;l<h;l+=4){if((l+1)%this._MAX_WORDS_PER_BURST===0){this._gate()}m=this._gen4words();j.push(m[0],m[1],m[2],m[3])}this._gate();return j.slice(0,h)},setDefaultParanoia:function(h,g){if(h===0&&g!=="Setting paranoia=0 will ruin your security; use it only for testing"){throw"Setting paranoia=0 will ruin your security; use it only for testing"}this._defaultParanoia=h},addEntropy:function(l,r,g){g=g||"user";var h,m,n,p=(new Date).valueOf(),j=this._robins[g],q=this.isReady(),k=0,o;h=this._collectorIds[g];if(h===undefined){h=this._collectorIds[g]=this._collectorIdNext++}if(j===undefined){j=this._robins[g]=0}this._robins[g]=(this._robins[g]+1)%this._pools.length;switch(typeof l){case"number":if(r===undefined){r=1}this._pools[j].update([h,this._eventId++,1,r,p,1,l|0]);break;case"object":o=Object.prototype.toString.call(l);if(o==="[object Uint32Array]"){n=[];for(m=0;m<l.length;m++){n.push(l[m])}l=n}else{if(o!=="[object Array]"){k=1}for(m=0;m<l.length&&!k;m++){if(typeof l[m]!=="number"){k=1}}}if(!k){if(r===undefined){r=0;for(m=0;m<l.length;m++){n=l[m];while(n>0){r++;n=n>>>1}}}this._pools[j].update([h,this._eventId++,2,r,p,l.length].concat(l))}break;case"string":if(r===undefined){r=l.length}this._pools[j].update([h,this._eventId++,3,r,p,l.length]);this._pools[j].update(l);break;default:k=1}if(k){throw new a.exception.bug("random: addEntropy only supports number, array of numbers or string")}this._poolEntropy[j]+=r;this._poolStrength+=r;if(q===this._NOT_READY){if(this.isReady()!==this._NOT_READY){this._fireEvent("seeded",Math.max(this._strength,this._poolStrength))}this._fireEvent("progress",this.getProgress())}},isReady:function(h){var g=this._PARANOIA_LEVELS[h!==undefined?h:this._defaultParanoia];if(this._strength&&this._strength>=g){return this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY}else{return this._poolStrength>=g?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY}},getProgress:function(h){var g=this._PARANOIA_LEVELS[h?h:this._defaultParanoia];if(this._strength>=g){return 1}else{return this._poolStrength>g?1:this._poolStrength/g}},startCollectors:function(){if(this._collectorsStarted){return}this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector)};if(window.addEventListener){window.addEventListener("load",this._eventListener.loadTimeCollector,false);window.addEventListener("mousemove",this._eventListener.mouseCollector,false);window.addEventListener("keypress",this._eventListener.keyboardCollector,false);window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,false)}else{if(document.attachEvent){document.attachEvent("onload",this._eventListener.loadTimeCollector);document.attachEvent("onmousemove",this._eventListener.mouseCollector);document.attachEvent("keypress",this._eventListener.keyboardCollector)}else{throw new a.exception.bug("can't attach event")}}this._collectorsStarted=true},stopCollectors:function(){if(!this._collectorsStarted){return}if(window.removeEventListener){window.removeEventListener("load",this._eventListener.loadTimeCollector,false);window.removeEventListener("mousemove",this._eventListener.mouseCollector,false);window.removeEventListener("keypress",this._eventListener.keyboardCollector,false);window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,false)}else{if(document.detachEvent){document.detachEvent("onload",this._eventListener.loadTimeCollector);document.detachEvent("onmousemove",this._eventListener.mouseCollector);document.detachEvent("keypress",this._eventListener.keyboardCollector)}}this._collectorsStarted=false},addEventListener:function(g,h){this._callbacks[g][this._callbackI++]=h},removeEventListener:function(m,g){var n,l,k=this._callbacks[m],h=[];for(l in k){if(k.hasOwnProperty(l)&&k[l]===g){h.push(l)}}for(n=0;n<h.length;n++){l=h[n];delete k[l]}},_bind:function(h){var g=this;return function(){h.apply(g,arguments)}},_gen4words:function(){for(var g=0;g<4;g++){this._counter[g]=this._counter[g]+1|0;if(this._counter[g]){break}}return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words());this._cipher=new a.cipher.aes(this._key)},_reseed:function(h){this._key=a.hash.sha256.hash(this._key.concat(h));this._cipher=new a.cipher.aes(this._key);for(var g=0;g<4;g++){this._counter[g]=this._counter[g]+1|0;if(this._counter[g]){break}}},_reseedFromPools:function(j){var g=[],k=0,h;this._nextReseed=g[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED;for(h=0;h<16;h++){g.push(Math.random()*4294967296|0)}for(h=0;h<this._pools.length;h++){g=g.concat(this._pools[h].finalize());k+=this._poolEntropy[h];this._poolEntropy[h]=0;if(!j&&this._reseedCount&1<<h){break}}if(this._reseedCount>=1<<this._pools.length){this._pools.push(new a.hash.sha256);this._poolEntropy.push(0)}this._poolStrength-=k;if(k>this._strength){this._strength=k}this._reseedCount++;this._reseed(g)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(h){var g=h.x||h.clientX||h.offsetX||0,i=h.y||h.clientY||h.offsetY||0;a.random.addEntropy([g,i],2,"mouse");this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(g){if(window&&window.performance&&typeof window.performance.now==="function"){a.random.addEntropy(window.performance.now(),g,"loadtime")}else{a.random.addEntropy((new Date).valueOf(),g,"loadtime")}},_accelerometerCollector:function(h){var g=h.accelerationIncludingGravity.x||h.accelerationIncludingGravity.y||h.accelerationIncludingGravity.z;if(window.orientation){var i=window.orientation;if(typeof i==="number"){a.random.addEntropy(i,1,"accelerometer")}}if(g){a.random.addEntropy(g,2,"accelerometer")}this._addCurrentTimeToEntropy(0)},_fireEvent:function(k,g){var i,h=a.random._callbacks[k],l=[];for(i in h){if(h.hasOwnProperty(i)){l.push(h[i])}}for(i=0;i<l.length;i++){l[i](g)}}};a.random=new a.prng(6);(function(){try{var h,j,g,i;if(typeof module!=="undefined"&&module.exports&&(j=require("crypto"))&&j.randomBytes){h=j.randomBytes(1024/8);h=new Uint32Array((new Uint8Array(h)).buffer);a.random.addEntropy(h,1024,"crypto.randomBytes")}else{if(window&&Uint32Array){i=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues){window.crypto.getRandomValues(i)}else{if(window.msCrypto&&window.msCrypto.getRandomValues){window.msCrypto.getRandomValues(i)}else{return}}a.random.addEntropy(i,1024,"crypto.getRandomValues")}else{}}}catch(k){console.log("There was an error collecting entropy from the browser:");console.log(k)}})()}).call(this);