(function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=n}for(var o in e)t.call(e,o)&&(n[o]=e[o])
return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=this
this.OpenPay=function(){function e(){}return e.version=1,e.sandboxMode=!1,e.developMode=!1,e.hostname="https://api.openpay.mx/v1/",e.sandboxHostname="https://sandbox-api.openpay.mx/v1/",e.developHostname="https://dev-api.openpay.mx/v1/",e.setSandboxMode=function(t){e.sandboxMode=t?!0:!1,t&&(e.developMode=!1)},e.getSandboxMode=function(){return e.sandboxMode},e.setDevelopMode=function(t){e.developMode=t?!0:!1,t&&(e.sandboxMode=!1)},e.getDevelopMode=function(){return e.developMode},e.setId=function(t){e.id=t},e.setApiKey=function(t){e.key=t},e.log=function(e){"object"==typeof e&&"toString"in e&&(e=""+e),"undefined"!=typeof console&&"log"in console&&console.log(e)},e.validate=function(e,t){if(!e)throw t+" required"
if("object"!=typeof e)throw t+" invalid"},e.formatData=function(e){return e},e.send=function(t,n,r,o){function a(e,t){var n=typeof e[t]
return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function i(e){var t=e+":",n=btoa(t)
return n}function s(){return"undefined"!=typeof XDomainRequest?new XDomainRequest:a(window,"XMLHttpRequest")?new XMLHttpRequest:void 0}function u(e,t,n){clearTimeout(l)
var r=null
e=e||"Unknown error",t=t||0,n=n||"{}"
try{r=JSON.parse(n)}catch(a){e="Response error"}o({message:e,status:t,data:r,toString:function(){return this.message+" [status "+this.status+"]"}})}function c(){if(void 0!==d.readyState&&4==d.readyState||"undefined"!=typeof XDomainRequest)if(clearTimeout(l),d.status<200||d.status>=300)u("Request error",d.status,d.responseText)
else try{r({data:JSON.parse(d.responseText),status:200})}catch(e){u("Response error (Unknown final status)",d.status,"{}")}}var d=null,l=null,p="",f="",h={},y=0,v=""
if(void 0===e.id||!/^[a-z0-9]+$/i.test(e.id))return u("Empty or invalid OpenPay ID"),void 0
if(void 0===e.key||!/^pk_[a-z0-9]+$/i.test(e.key))return u("Empty or invalid OpenPay API Key"),void 0
if("function"!=typeof r&&(r=e.log),"function"!=typeof o&&(o=e.log),"undefined"==typeof JSON)return u("Browser error (JSON library not found)"),void 0
if(!(d=s()))return u("Browser error (CORS not supported)"),void 0
v=i(e.key),p=(e.sandboxMode?e.sandboxHostname:e.hostname)+e.id+"/"+t,f=JSON.stringify(n),h={Accept:"application/json","Content-Type":"application/json",Authorization:"Basic "+v},y=4e4,"withCredentials"in d&&(d.withCredentials=!0),d.open("POST",p,!0)
for(var m in h)h.hasOwnProperty(m)&&h[m]&&"setRequestHeader"in d&&d.setRequestHeader(m,h[m])
"onreadystatechange"in d?d.onreadystatechange=c:"onload"in d&&"onerror"in d&&(d.onload=c,d.onerror=u),l=setTimeout(function(){"onload"in d?d.onload=Function.prototype:d.onreadystatechange=Function.prototype,d.abort(),d=null,u("Timeout after "+y+" milliseconds")},y),d.send(f)},e}.call(this),e=this.OpenPay,this.OpenPay.card=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return n(t,r),r.tokenName="card",r.whitelistedAttrs=["card_number","holder_name","cvv2","expiration_month","expiration_year","address"],r.create=function(t,n,o,a){var i="cards"
return void 0!==a&&""!==a&&(i="customers/"+a+"/cards"),e.validate(t,"tarjeta"),e.formatData(t,r.whitelistedAttrs),e.send(i,t,n,o)},r.validateCardNumber=function(e){return e=(e+"").replace(/\s+|-/g,""),/^\d+$/.test(e)&&e.length>=10&&e.length<=16&&r.luhnCheck(e)&&r.validateCardNumberLength(e)&&r.validateAcceptCardNumber(e)},r.validateCVC=function(t){return t=e.utils.trim(t),/^\d+$/.test(t)&&t.length>=3&&t.length<=4},r.validateExpiry=function(t,n){var r,o
return t=e.utils.trim(t),n=e.utils.trim(n),/^\d+$/.test(t)?/^\d+$/.test(n)?parseInt(t,10)<=12?(o=new Date(n,t),r=new Date,o.setMonth(o.getMonth()-1),o.setMonth(o.getMonth()+1,1),o>r):!1:!1:!1},r.validateCardNumberLength=function(e){var t=null
if(t=r.cardAbstract(e))for(var n=t.length.length;n--;)if(t.length[n]==e.length)return!0
return!1},r.validateAcceptCardNumber=function(e){var t=null
return(t=r.cardAbstract(e))?t.accept:!1},r.luhnCheck=function(e){var t,n,o,a,i,s
for(o=!0,a=0,n=(e+"").split("").reverse(),i=0,s=r.length;s>i;i++)t=n[i],t=parseInt(t,10),(o=!o)&&(t*=2),t>9&&(t-=9),a+=t
return a%10===0},r.cardType=function(e){var t=null
return(t=r.cardAbstract(e))?t.name:""},r.cardTypes=function(){return{visa_electron:{name:"Visa Electron",regx:/^(4026|417500|4508|4844|491(3|7))/,length:[16],accept:!0},visa:{name:"Visa",regx:/^4/,length:[16],accept:!0},mastercard:{name:"Mastercard",regx:/^5[1-5]/,length:[16],accept:!0},amex:{name:"American Express",regx:/^3[47]/,length:[15],accept:!1},diners_cb:{name:"Diners Club Carte Blanche",regx:/^30[0-5]/,length:[14],accept:!1},diners_int:{name:"Diners Club International",regx:/^36/,length:[14],accept:!1},jcb:{name:"JCB",regx:/^35(2[89]|[3-8][0-9])/,length:[16],accept:!1},laser:{name:"Laser",regx:/^(6304|670[69]|6771)/,length:[16,17,18,19],accept:!1},maestro:{name:"Maestro",regx:/^(5018|5020|5038|6304|6759|676[1-3])/,length:[12,13,14,15,16,17,18,19],accept:!1},discover:{name:"Discover",regx:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,length:[16],accept:!1}}},r.cardAbstract=function(e){var t={}
t=r.cardTypes()
for(var n in t)if(_cardObj=t[n],e.match(_cardObj.regx))return _cardObj
return!1},r}.call(this,this.OpenPay),this.OpenPay.utils=function(e){function t(){}return n(e,t),t.trim=function(e){return(e+"").replace(/^\s+|\s+$/g,"")},t.underscore=function(e){return(e+"").replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()}).replace(/-/g,"_")},t.underscoreKeys=function(e){var t,n
n=[]
for(var r in e)t=e[r],delete e[r],n.push(e[this.underscore(r)]=t)
return n},t.isElement=function(e){return"object"!=typeof e?!1:"undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery?!0:1===e.nodeType},t}.call(this,this.OpenPay),"undefined"!=typeof module&&null!==module&&(module.exports=this.OpenPay),"function"==typeof define&&define("openpay",[],function(){return r.OpenPay})}).call(this)
