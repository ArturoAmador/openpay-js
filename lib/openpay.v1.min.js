(function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=t}for(var i in e){n.call(e,i)&&(t[i]=e[i])}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i=this;this.OpenPay=function(){function e(){}return e.version=1,e.sandboxMode=false,e.developMode=false,e.hostname="https://api.openpay.mx/v1/",e.sandboxHostname="https://sandbox-api.openpay.mx/v1/",e.developHostname="https://dev-api.openpay.mx/v1/",e.setSandboxMode=function(t){e.sandboxMode=t?true:false;if(t){e.developMode=false}},e.getSandboxMode=function(){return e.sandboxMode},e.setDevelopMode=function(t){e.developMode=t?true:false;if(t){e.sandboxMode=false}},e.getDevelopMode=function(){return e.developMode},e.setId=function(t){e.id=t},e.setApiKey=function(t){e.key=t},e.log=function(e){if(typeof e==="object"&&"toString"in e){e=e.toString()}if(typeof console!=="undefined"&&"log"in console){console.log(e)}},e.validate=function(e,t){if(!e)throw t+" required";if(typeof e!=="object")throw t+" invalid"},e.formatData=function(e,t){return e},e.extractFormInfo=function(e){var t,n,r,i;var s=function(e){if(window.jQuery&&e instanceof jQuery){return e[0]}else if(e.nodeType&&e.nodeType===1){return e}else{return document.getElementById(e)}};var o=function(e,t){var n=[],r=e.children,i,s;for(s=0;s<r.length;s++){i=r[s];if(i.nodeType===1&&i.attributes[t]){n.push(i)}else if(i.children.length>0){n=n.concat(o(i,t))}}return n};var u=function(e,t){var n={};for(var r=0;r<e.length;r++){fieldName=e[r].attributes[t].value;inputValue=e[r].value;if(n[fieldName]!==undefined){if(!n[fieldName].push){n[this.name]=[n[this.name]]}n[fieldName].push(inputValue||"")}else{n[fieldName]=inputValue||""}}return n};e=s(e);t=o(e,"data-openpay-card");n=u(t,"data-openpay-card");i=o(e,"data-openpay-card-address");if(i!==undefined&&i.length&&i.length>0){r=u(i,"data-openpay-card-address");if(r!==undefined){n["address"]=r}}return n},e.send=function(t,n,r,i){function h(e,t){var n=typeof e[t];return n=="function"||!!(n=="object"&&e[t])||n=="unknown"}function p(e){var t=e+":";var n=btoa(t);return n}function d(){if(typeof XDomainRequest!=="undefined"){return new XDomainRequest}else if(h(window,"XMLHttpRequest")){return new XMLHttpRequest}}function v(e,t,n){clearTimeout(o);var r=null;e=e||"Unknown error";t=t||0;n=n||"{}";try{r=JSON.parse(n)}catch(s){e="Response error"}i({message:e,status:t,data:r,toString:function(){return this.message+" [status "+this.status+"]"}})}function m(){if(typeof s.readyState!=="undefined"&&s.readyState==4||typeof XDomainRequest!=="undefined"){clearTimeout(o);if(s.status<200||s.status>=300){v("Request error",s.status,s.responseText)}else{try{r({data:JSON.parse(s.responseText),status:200})}catch(e){v("Response error (Unknown final status)",s.status,"{}")}}}}var s=null,o=null,u="",a="",f={},l=0,c="";if(typeof e.id==="undefined"||!/^[a-z0-9]+$/i.test(e.id)){v("Empty or invalid OpenPay ID");return}if(typeof e.key==="undefined"||!/^pk_[a-z0-9]+$/i.test(e.key)){v("Empty or invalid OpenPay API Key");return}if(typeof r!=="function"){r=e.log}if(typeof i!=="function"){i=e.log}if(typeof JSON==="undefined"){v("Browser error (JSON library not found)");return}if(!(s=d())){v("Browser error (CORS not supported)");return}c=p(e.key);if(e.sandboxMode){u=e.sandboxHostname}else if(e.developMode){u=e.developHostname}else{u=e.hostname}u=u+e.id+"/"+t;a=JSON.stringify(n);f={Accept:"application/json","Content-Type":"application/json",Authorization:"Basic "+c};l=4e4;s.open("POST",u,true);if("withCredentials"in s){s.withCredentials=true}for(var g in f){if(f.hasOwnProperty(g)&&f[g]){if("setRequestHeader"in s){s.setRequestHeader(g,f[g])}}}if("onreadystatechange"in s){s.onreadystatechange=m}else if("onload"in s&&"onerror"in s){s.onload=m;s.onerror=v}o=setTimeout(function(){if("onload"in s){s.onload=Function.prototype}else{s.onreadystatechange=Function.prototype}s.abort();s=null;v("Timeout after "+l+" milliseconds")},l);s.send(a)},e}.call(this),e=this.OpenPay,this.OpenPay.card=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(t,n),n.validateCardNumber=function(e){return e=(e+"").replace(/\s+|-/g,""),/^\d+$/.test(e)&&e.length>=10&&e.length<=16&&n.luhnCheck(e)&&n.validateCardNumberLength(e)&&n.validateAcceptCardNumber(e)},n.validateCVC=function(t){return t=e.utils.trim(t),/^\d+$/.test(t)&&t.length>=3&&t.length<=4},n.validateExpiry=function(t,n){var r,i;return t=e.utils.trim(t),n=e.utils.trim(n),/^\d+$/.test(t)?/^\d+$/.test(n)?parseInt(t,10)<=12?(i=new Date(n,t),r=new Date,i.setMonth(i.getMonth()-1),i.setMonth(i.getMonth()+1,1),i>r):!1:!1:!1},n.validateCardNumberLength=function(e){var t=null;if(t=n.cardAbstract(e)){var r=t.length.length;while(r--){if(t.length[r]==e.length){return true}}}return false},n.validateAcceptCardNumber=function(e){var t=null;if(t=n.cardAbstract(e)){return t.accept}return false},n.luhnCheck=function(e){var t,r,i,s,o,u;i=!0,s=0,r=(e+"").split("").reverse();for(o=0,u=n.length;o<u;o++){t=r[o],t=parseInt(t,10);if(i=!i)t*=2;t>9&&(t-=9),s+=t}return s%10===0},n.cardType=function(e){var t=null;if(t=n.cardAbstract(e)){return t.name}return""},n.cardTypes=function(){return{visa_electron:{name:"Visa Electron",regx:/^(4026|417500|4508|4844|491(3|7))/,length:[16],accept:true},visa:{name:"Visa",regx:/^4/,length:[16],accept:true},mastercard:{name:"Mastercard",regx:/^5[1-5]/,length:[16],accept:true},amex:{name:"American Express",regx:/^3[47]/,length:[15],accept:true},diners_cb:{name:"Diners Club Carte Blanche",regx:/^30[0-5]/,length:[14],accept:false},diners_int:{name:"Diners Club International",regx:/^36/,length:[14],accept:false},jcb:{name:"JCB",regx:/^35(2[89]|[3-8][0-9])/,length:[16],accept:false},laser:{name:"Laser",regx:/^(6304|670[69]|6771)/,length:[16,17,18,19],accept:false},maestro:{name:"Maestro",regx:/^(5018|5020|5038|6304|6759|676[1-3])/,length:[12,13,14,15,16,17,18,19],accept:false},discover:{name:"Discover",regx:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,length:[16],accept:false}}},n.cardAbstract=function(e){var t={};t=n.cardTypes();for(var r in t){_cardObj=t[r];if(e.match(_cardObj.regx)){return _cardObj}}return false},n}.call(this,this.OpenPay),this.OpenPay.token=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(t,n),n.whitelistedAttrs=["card_number","holder_name","cvv2","expiration_month","expiration_year","address"],n.extractFormAndCreate=function(t,r,i,s){var o=e.extractFormInfo(t);return n.create(o,r,i)},n.create=function(t,r,i){var s="tokens";return e.validate(t,"tarjeta"),e.formatData(t,n.whitelistedAttrs),e.send(s,t,r,i)},n}.call(this,this.OpenPay),this.OpenPay.utils=function(e){function t(){}return r(e,t),t.trim=function(e){return(e+"").replace(/^\s+|\s+$/g,"")},t.underscore=function(e){return(e+"").replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()}).replace(/-/g,"_")},t.underscoreKeys=function(e){var t,n;n=[];for(var r in e)t=e[r],delete e[r],n.push(e[this.underscore(r)]=t);return n},t.isElement=function(e){return typeof e!="object"?!1:typeof jQuery!="undefined"&&jQuery!==null&&e instanceof jQuery?!0:e.nodeType===1},t}.call(this,this.OpenPay),typeof module!="undefined"&&module!==null&&(module.exports=this.OpenPay),typeof define=="function"&&define("openpay",[],function(){return i.OpenPay})}).call(this)
