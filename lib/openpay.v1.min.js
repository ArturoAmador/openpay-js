(function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=n}for(var a in e)t.call(e,a)&&(n[a]=e[a])
return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=this
this.OpenPay=function(){function e(){}return e.version=1,e.sandboxMode=!1,e.developMode=!1,e.hostname="https://api.openpay.mx/v1/",e.sandboxHostname="https://sandbox-api.openpay.mx/v1/",e.developHostname="https://dev-api.openpay.mx/v1/",e.setSandboxMode=function(t){e.sandboxMode=t?!0:!1,t&&(e.developMode=!1)},e.getSandboxMode=function(){return e.sandboxMode},e.setDevelopMode=function(t){e.developMode=t?!0:!1,t&&(e.sandboxMode=!1)},e.getDevelopMode=function(){return e.developMode},e.setId=function(t){e.id=t},e.setApiKey=function(t){e.key=t},e.log=function(e){"object"==typeof e&&"toString"in e&&(e=""+e),"undefined"!=typeof console&&"log"in console&&console.log(e)},e.validate=function(e,t){if(!e)throw t+" required"
if("object"!=typeof e)throw t+" invalid"},e.formatData=function(e){return e},e.send=function(t,n,r,a){function o(e,t){var n=typeof e[t]
return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function i(e){var t=e+":",n=btoa(t)
return n}function s(){return"undefined"!=typeof XDomainRequest?new XDomainRequest:o(window,"XMLHttpRequest")?new XMLHttpRequest:void 0}function u(e,t,n){clearTimeout(l)
var r=null
e=e||"Unknown error",t=t||0,n=n||"{}"
try{r=JSON.parse(n)}catch(o){e="Response error"}a({message:e,status:t,data:r,toString:function(){return this.message+" [status "+this.status+"]"}})}function d(){if(void 0!==c.readyState&&4==c.readyState||"undefined"!=typeof XDomainRequest)if(clearTimeout(l),c.status<200||c.status>=300)u("Request error",c.status,c.responseText)
else try{r({data:JSON.parse(c.responseText),status:200})}catch(e){u("Response error (Unknown final status)",c.status,"{}")}}var c=null,l=null,p="",f="",h={},y=0,m=""
if(void 0===e.id||!/^[a-z0-9]+$/i.test(e.id))return u("Empty or invalid OpenPay ID"),void 0
if(void 0===e.key||!/^pk_[a-z0-9]+$/i.test(e.key))return u("Empty or invalid OpenPay API Key"),void 0
if("function"!=typeof r&&(r=e.log),"function"!=typeof a&&(a=e.log),"undefined"==typeof JSON)return u("Browser error (JSON library not found)"),void 0
if(!(c=s()))return u("Browser error (CORS not supported)"),void 0
m=i(e.key),p=e.sandboxMode?e.sandboxHostname:e.developMode?e.developHostname:e.hostname,p=p+e.id+"/"+t,f=JSON.stringify(n),h={Accept:"application/json","Content-Type":"application/json",Authorization:"Basic "+m},y=4e4,"withCredentials"in c&&(c.withCredentials=!0),c.open("POST",p,!0)
for(var v in h)h.hasOwnProperty(v)&&h[v]&&"setRequestHeader"in c&&c.setRequestHeader(v,h[v])
"onreadystatechange"in c?c.onreadystatechange=d:"onload"in c&&"onerror"in c&&(c.onload=d,c.onerror=u),l=setTimeout(function(){"onload"in c?c.onload=Function.prototype:c.onreadystatechange=Function.prototype,c.abort(),c=null,u("Timeout after "+y+" milliseconds")},y),c.send(f)},e}.call(this),e=this.OpenPay,this.OpenPay.card=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return n(t,r),r.tokenName="card",r.whitelistedAttrs=["card_number","holder_name","cvv2","expiration_month","expiration_year","address"],r.extractFormInfo=function(e){var t,n,r,a,o=function(e){return window.jQuery&&e instanceof jQuery?e[0]:e.nodeType&&1===e.nodeType?e:document.getElementById(e)},i=function(e,t){var n,r,a=[],o=e.children
for(r=0;r<o.length;r++)n=o[r],1===n.nodeType&&n.attributes[t]?a.push(n):n.children.length>0&&(a=a.concat(i(n,t)))
return a},s=function(e,t){for(var n={},r=0;r<e.length;r++)fieldName=e[r].attributes[t].value,inputValue=e[r].value,void 0!==n[fieldName]?(n[fieldName].push||(n[this.name]=[n[this.name]]),n[fieldName].push(inputValue||"")):n[fieldName]=inputValue||""
return n}
return e=o(e),t=i(e,"data-openpay-card"),n=s(t,"data-openpay-card"),a=i(e,"data-openpay-card-address"),void 0!==a&&a.length&&a.length>0&&(r=s(a,"data-openpay-card-address"),void 0!==r&&(n.address=r)),n},r.extractFormAndCreate=function(e,t,n,a){var o=r.extractFormInfo(e)
return r.create(o,t,n,a)},r.create=function(t,n,a,o){var i="cards"
return void 0!==o&&""!==o&&(i="customers/"+o+"/cards"),e.validate(t,"tarjeta"),e.formatData(t,r.whitelistedAttrs),e.send(i,t,n,a)},r.validateCardNumber=function(e){return e=(e+"").replace(/\s+|-/g,""),/^\d+$/.test(e)&&e.length>=10&&e.length<=16&&r.luhnCheck(e)&&r.validateCardNumberLength(e)&&r.validateAcceptCardNumber(e)},r.validateCVC=function(t){return t=e.utils.trim(t),/^\d+$/.test(t)&&t.length>=3&&t.length<=4},r.validateExpiry=function(t,n){var r,a
return t=e.utils.trim(t),n=e.utils.trim(n),/^\d+$/.test(t)?/^\d+$/.test(n)?parseInt(t,10)<=12?(a=new Date(n,t),r=new Date,a.setMonth(a.getMonth()-1),a.setMonth(a.getMonth()+1,1),a>r):!1:!1:!1},r.validateCardNumberLength=function(e){var t=null
if(t=r.cardAbstract(e))for(var n=t.length.length;n--;)if(t.length[n]==e.length)return!0
return!1},r.validateAcceptCardNumber=function(e){var t=null
return(t=r.cardAbstract(e))?t.accept:!1},r.luhnCheck=function(e){var t,n,a,o,i,s
for(a=!0,o=0,n=(e+"").split("").reverse(),i=0,s=r.length;s>i;i++)t=n[i],t=parseInt(t,10),(a=!a)&&(t*=2),t>9&&(t-=9),o+=t
return o%10===0},r.cardType=function(e){var t=null
return(t=r.cardAbstract(e))?t.name:""},r.cardTypes=function(){return{visa_electron:{name:"Visa Electron",regx:/^(4026|417500|4508|4844|491(3|7))/,length:[16],accept:!0},visa:{name:"Visa",regx:/^4/,length:[16],accept:!0},mastercard:{name:"Mastercard",regx:/^5[1-5]/,length:[16],accept:!0},amex:{name:"American Express",regx:/^3[47]/,length:[15],accept:!1},diners_cb:{name:"Diners Club Carte Blanche",regx:/^30[0-5]/,length:[14],accept:!1},diners_int:{name:"Diners Club International",regx:/^36/,length:[14],accept:!1},jcb:{name:"JCB",regx:/^35(2[89]|[3-8][0-9])/,length:[16],accept:!1},laser:{name:"Laser",regx:/^(6304|670[69]|6771)/,length:[16,17,18,19],accept:!1},maestro:{name:"Maestro",regx:/^(5018|5020|5038|6304|6759|676[1-3])/,length:[12,13,14,15,16,17,18,19],accept:!1},discover:{name:"Discover",regx:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,length:[16],accept:!1}}},r.cardAbstract=function(e){var t={}
t=r.cardTypes()
for(var n in t)if(_cardObj=t[n],e.match(_cardObj.regx))return _cardObj
return!1},r}.call(this,this.OpenPay),this.OpenPay.utils=function(e){function t(){}return n(e,t),t.trim=function(e){return(e+"").replace(/^\s+|\s+$/g,"")},t.underscore=function(e){return(e+"").replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()}).replace(/-/g,"_")},t.underscoreKeys=function(e){var t,n
n=[]
for(var r in e)t=e[r],delete e[r],n.push(e[this.underscore(r)]=t)
return n},t.isElement=function(e){return"object"!=typeof e?!1:"undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery?!0:1===e.nodeType},t}.call(this,this.OpenPay),"undefined"!=typeof module&&null!==module&&(module.exports=this.OpenPay),"function"==typeof define&&define("openpay",[],function(){return r.OpenPay})}).call(this)
